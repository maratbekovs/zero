<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Панель Модератора | ZERO Help Desk</title>
    <!-- iOS PWA -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ZERO">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="apple-touch-icon" sizes="57x57"   href="/icons/apple-touch-icon-57.png">
<link rel="apple-touch-icon" sizes="60x60"   href="/icons/apple-touch-icon-60.png">
<link rel="apple-touch-icon" sizes="72x72"   href="/icons/apple-touch-icon-72.png">
<link rel="apple-touch-icon" sizes="76x76"   href="/icons/apple-touch-icon-76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-touch-icon-114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120.png">
<link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152.png">
<link rel="apple-touch-icon" sizes="167x167" href="/icons/apple-touch-icon-167.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        :root{
            --primary:#4361ee;
            --primary-600:#3a56d4;
            --danger:#e63946;
            --danger-600:#d32f2f;
            --success:#2a9d8f;
            --warning:#f4a261;

            --bg:#f4f6f9;
            --text:#2d3748;
            --muted:#718096;

            --card:#fff;
            --border:#e2e8f0;

            --radius:12px;
            --shadow:0 6px 18px rgba(0,0,0,0.08);
            --shadow-lg:0 14px 28px rgba(0,0,0,0.12);
        }

        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0;
            background:var(--bg);
            color:var(--text);
            font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
        }

        .mobile-header{
            display:none;
            position:fixed; top:0; left:0; right:0; z-index:1002;
            background:var(--card);
            border-bottom:1px solid var(--border);
            padding:12px 16px calc(12px + env(safe-area-inset-top));
            align-items:center; justify-content:center;
        }
        .mobile-header .title{
            margin:0; font-size:16px; color:var(--primary); font-weight:700; text-align:center;
        }

        .layout{ display:flex; min-height:100vh; }
        .sidebar{
            width:280px;
            background:linear-gradient(135deg,#111827,#1f2937);
            color:#e5e7eb;
            display:flex; flex-direction:column;
            padding:20px 0;
        }
        .brand{ padding:0 24px 16px; border-bottom:1px solid rgba(255,255,255,0.08); margin-bottom:16px; }
        .brand h1{ margin:0; font-size:20px; letter-spacing:.2px; }

        .nav{ display:flex; flex-direction:column; gap:6px; padding:0 8px; }
        .nav a{
            display:flex; align-items:center; gap:12px; padding:12px 16px; margin:0 8px;
            color:#e5e7eb; text-decoration:none; border-radius:10px; transition:.2s ease;
        }
        .nav a:hover{ background:rgba(255,255,255,.06); }
        .nav a.active{ background:var(--primary); color:#fff; box-shadow:0 6px 16px rgba(67,97,238,.35); }

        .sidebar-footer{ margin-top:auto; padding:16px; border-top:1px solid rgba(255,255,255,.08); }
        .user-badge{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:12px; font-size:14px; }
        .user-badge .muted{opacity:.8}

        .main{ flex:1; padding:24px; }

        .section{ display:none; }
        .section.active{ display:block; }

        .toolbar{ display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; gap:12px; }

        .input, select, .date{
            background:#fff; border:1px solid var(--border);
            padding:12px 14px;
            border-radius:10px; outline:none; transition:.2s ease; font-size:14px;
        }
        .input:focus, select:focus, .date:focus{ border-color:var(--primary); box-shadow:0 0 0 3px rgba(67,97,238,.15); }

        .btn{
            background:var(--primary); color:#fff; padding:10px 14px; border:none; border-radius:10px; cursor:pointer; font-weight:600; transition:.2s ease;
        }
        .btn:hover{ background:var(--primary-600); transform:translateY(-1px); }
        .btn.secondary{ background:#e9efff; color:#1f3bb3; }
        .btn.ghost{ background:transparent; color:var(--text); border:1px solid var(--border); }
        .btn.danger{ background:var(--danger); }
        .btn.danger:hover{ background:var(--danger-600); }
        .btn.success{ background:var(--success); }
        .btn.small{ padding:8px 12px; font-size:13px; }

        .chips{ display:flex; gap:8px; flex-wrap:wrap; }
        .chip{ font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#fff; }

        .grid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; }
        .card{ background:#fff; border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); }
        .card .card-header{ padding:16px 16px 0 16px; }
        .card .card-body{ padding:20px; }

        .table-wrap{ overflow:auto; border-radius:12px; }
        table{ width:100%; border-collapse:collapse; }
        th,td{ text-align:left; padding:12px; border-bottom:1px solid var(--border); font-size:14px; vertical-align:top; }
        thead th{ background:#f8fafc; position:sticky; top:0; z-index:1; }
        tr:hover td{ background:#fafcff; }

        .status{ display:inline-block; padding:6px 10px; border-radius:999px; color:#fff; font-weight:600; font-size:12px; line-height:1; }
        .s-New{ background:var(--primary); }
        .s-In\ Progress{ background:var(--warning); }
        .s-Successful{ background:var(--success); }
        .s-Rejected{ background:var(--danger); }
        .s-On\ Hold{ background:#7209b7; }

        /* Desktop chat panel */
        .chat{ display:flex; flex-direction:column; height:78vh; min-height:520px; }
        .chat-head{ display:flex; justify-content:space-between; align-items:flex-start; gap:8px; padding:16px; border-bottom:1px solid var(--border); }
        .chat-title{ margin:0; font-size:16px; }
        .chat-meta{ font-size:13px; color:var(--muted); }
        .chat-box{ flex:1; overflow:auto; padding:16px; display:flex; flex-direction:column; gap:10px; background:linear-gradient(180deg,#fff 0%, #fbfcff 100%); }

        .msg{ max-width:80%; padding:12px 14px; border-radius:14px; box-shadow:var(--shadow); position:relative; display:flex; flex-direction:column; gap:6px; animation:fadeIn .2s ease; }
        .msg.me{ align-self:flex-end; background:var(--primary); color:#fff; border-bottom-right-radius:6px; }
        .msg.other{ align-self:flex-start; background:#f1f5f9; color:var(--text); border-bottom-left-radius:6px; }
        .msg .meta{ font-size:12px; opacity:.8; }
        .msg .attach img, .msg .attach video{ max-width:280px; border-radius:10px; display:block; }

        .chat-actions{ border-top:1px solid var(--border); padding:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; background:#fff; }
        .chat-actions .input{ flex:1; }

        .preview{ background:#f8fafc; border:1px dashed var(--border); border-radius:10px; padding:10px; display:none; gap:10px; align-items:center; }
        .preview.show{ display:flex; }
        .preview img, .preview video{ max-height:100px; border-radius:6px; }

        .banner{ background:#fff3cd; color:#8a6d3b; padding:8px 12px; font-size:13px; border-top:1px solid #ffe8a1; border-bottom:1px solid #ffe8a1; }

        /* Mobile bottom tab bar (fixed) */
        .mobile-tab-bar{
            position:fixed; left:0; right:0; bottom:0; z-index:1001;
            display:none; gap:0; align-items:center; justify-content:space-around;
            background:#fff; border-top:1px solid var(--border);
            padding:10px 6px calc(10px + env(safe-area-inset-bottom));
            box-shadow:0 -8px 16px rgba(0,0,0,.06);
        }
        .tab-item{ flex:1; text-align:center; color:var(--muted); text-decoration:none; font-size:12px; display:flex; flex-direction:column; align-items:center; gap:4px; }
        .tab-item i{ font-style:normal; font-size:18px; }
        .tab-item.active{ color:var(--primary); font-weight:600; }

        /* Mobile chat modal */
        .mchat-modal{
            display:none; position:fixed; inset:0; z-index:1003; background:rgba(0,0,0,.45);
        }
        .mchat-wrap{
            position:absolute; inset:0; background:#fff; display:flex; flex-direction:column;
        }
        .mchat-head{
            position:sticky; top:0; z-index:2; background:#f8f9fb; border-bottom:1px solid var(--border);
            display:flex; align-items:center; justify-content:space-between; gap:8px;
            padding:12px 14px calc(12px + env(safe-area-inset-top));
        }
        .mchat-title{ margin:0; font-size:16px; font-weight:700; color:var(--text); }
        .mchat-sub{ font-size:12px; color:var(--muted); }
        .mchat-close{
            background:#fff; border:1px solid var(--border); border-radius:10px; cursor:pointer;
            width:36px; height:36px; font-size:18px; color:var(--text); display:flex; align-items:center; justify-content:center;
        }
        .mchat-close:hover, .mchat-close:focus{ background:#f3f4f6; outline:none; }

        .mstatus-bar{
            display:flex; gap:8px; align-items:center;
            padding:10px 12px; border-bottom:1px solid var(--border); background:#fff;
        }
        .mstatus-info{
            padding:6px 12px 8px; color:var(--muted); font-size:12px;
        }

        .mchat-box{ flex:1; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:10px; }
        .mmsg{ max-width:85%; padding:10px 12px; border-radius:14px; box-shadow:var(--shadow); display:flex; flex-direction:column; gap:6px; }
        .mmsg.me{ align-self:flex-end; background:var(--primary); color:#fff; border-bottom-right-radius:6px; }
        .mmsg.other{ align-self:flex-start; background:#f1f5f9; color:var(--text); border-bottom-left-radius:6px; }
        .mmsg .meta{ font-size:11px; opacity:.85; }
        .mmsg .attach img, .mmsg .attach video{ max-width:70vw; border-radius:10px; display:block; }

        .mchat-actions{
            position:sticky; bottom:0; z-index:2; background:#fff; border-top:1px solid var(--border);
            padding:10px 10px calc(10px + env(safe-area-inset-bottom));
            display:flex; gap:8px; align-items:center; flex-wrap:nowrap;
        }
        .mchat-actions .input{
            flex:1; min-width:0; border-radius:22px; padding:12px 14px; font-size:15px; min-height:44px;
        }
        .mattach-toggle{
            background:#fff; border:1px solid var(--border); color:var(--text);
            width:42px; height:42px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:20px;
        }
        #mchat-send{
            width:42px; height:42px; border-radius:12px; padding:0;
            display:flex; align-items:center; justify-content:center; font-size:18px;
        }
        .mattach-menu{
            position:absolute; bottom:62px; right:12px; z-index:3;
            background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow-lg);
            padding:8px; display:none; gap:8px; align-items:center;
        }
        .mattach-menu.open{ display:flex; }
        .mattach-menu .btn{ width:auto; padding:8px 10px; font-size:13px; }

        .mpreview{ background:#f8fafc; border:1px dashed var(--border); border-radius:10px; padding:8px; display:none; gap:8px; align-items:center; margin:8px 10px 10px; }
        .mpreview.show{ display:flex; }
        .mpreview img, .mpreview video{ max-height:90px; border-radius:6px; }

        /* Универсальная модалка */
        .modal-overlay{
            display:none; position:fixed; inset:0; z-index:1004; background:rgba(0,0,0,.45);
            align-items:center; justify-content:center; padding:20px;
        }
        .modal-panel{
            background:#fff; border:1px solid var(--border); border-radius:14px;
            box-shadow:var(--shadow-lg); width:100%; max-width:520px; overflow:hidden;
        }
        .modal-head{
            padding:12px 16px; background:#f8f9fb; border-bottom:1px solid var(--border);
            display:flex; align-items:center; justify-content:space-between; gap:8px;
        }
        .modal-title{ margin:0; font-size:16px; font-weight:700; color:var(--text); }
        .modal-close{ background:#fff; border:1px solid var(--border); border-radius:8px; padding:6px 10px; cursor:pointer; }
        .modal-body{ padding:18px; }
        .modal-body .stack{ display:flex; flex-direction:column; gap:14px; }
        .modal-footer{ padding:12px 16px; border-top:1px solid var(--border); display:flex; gap:8px; align-items:center; justify-content:flex-end; }

        @media (max-width: 1100px){
            .grid{ grid-template-columns:1fr; }
            .chat{ height:auto; }
        }
        @media (max-width: 768px){
            .mobile-header{ display:flex; }
            .sidebar{ display:none !important; }
            .main{ padding:72px 16px 96px; }
            .mobile-tab-bar{ display:flex; }
            .toolbar{ flex-direction:column; align-items:stretch; gap:10px; }
            thead th{ position:static; }
            #chat-panel{ display:none !important; }
        }
        @media (max-width: 480px){
            .main{ padding:72px 12px 98px; }
            .btn{ padding:9px 12px; font-size:13px; }
            .input, select, .date{ padding:10px 12px; font-size:13px; }
            th,td{ padding:10px; font-size:13px; }
            #tickets-table th.col-user, #tickets-table td.col-user,
            #tickets-table th.col-created, #tickets-table td.col-created { display:none; }
            /* В разделе "Пользователи" показываем все поля (responsive-карточки) */
            #report-table th.col-moderator, #report-table td.col-moderator,
            #report-table th.col-closed, #report-table td.col-closed { display:none; }
        }
    </style>
</head>
<body>
    <div class="mobile-header">
        <h1 class="title">ZERO 🛡️ Help Desk — Модератор</h1>
    </div>

    <div class="layout">
        <aside class="sidebar">
            <div class="brand"><h1>ZERO 🛡️ Help Desk</h1></div>
            <nav class="nav">
                <a href="#" class="nav-link active" data-section="tickets">🎫 Заявки</a>
                <a href="#" class="nav-link" data-section="users">👥 Пользователи</a>
                <a href="#" class="nav-link" data-section="reports">📈 Отчёты</a>
                <a href="#" class="nav-link" data-section="profile">👤 Профиль</a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-badge">
                    <div><strong id="me-username">...</strong></div>
                    <div class="muted" id="me-role">роль: ...</div>
                </div>
                <div class="row" style="margin-top:10px;">
                    <button class="btn ghost" id="btn-logout">Выйти</button>
                </div>
            </div>
        </aside>

        <main class="main">
            <!-- TICKETS -->
            <section class="section active" id="sec-tickets">
                <div class="toolbar">
                    <div class="row">
                        <input class="input" id="search" placeholder="Поиск по теме/пользователю..."/>
                        <select id="filter-status" class="input">
                            <option value="">Все статусы</option>
                            <option value="New">Новые</option>
                            <option value="In Progress">В работе</option>
                            <option value="On Hold">На согласовании</option>
                            <option value="Successful">Успешные</option>
                            <option value="Rejected">Отклонённые</option>
                        </select>
                        <button class="btn" id="btn-reload">Обновить</button>
                    </div>
                    <div class="chips">
                        <span class="chip">Всего: <span id="stat-total">0</span></span>
                        <span class="chip">Новые: <span id="stat-new">0</span></span>
                        <span class="chip">В работе: <span id="stat-ip">0</span></span>
                    </div>
                </div>

                <div class="grid">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-wrap">
                                <table id="tickets-table" class="responsive">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th class="col-user">Пользователь</th>
                                        <th>Тема</th>
                                        <th>Статус</th>
                                        <th class="col-created">Создан</th>
                                        <th>Действия</th>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Desktop chat panel -->
                    <div class="card chat" id="chat-panel">
                        <div class="chat-head">
                            <div>
                                <h3 class="chat-title">Чат: <span id="chat-ticket-id">—</span></h3>
                                <div class="chat-meta">
                                    Тема: <span id="chat-ticket-subject">—</span><br/>
                                    Клиент ID: <span id="chat-user-id">—</span> • Текущий статус: <strong id="current-status">—</strong>
                                </div>
                            </div>
                            <div>
                                <div class="row">
                                    <select id="status-select" class="input">
                                        <option value="In Progress">В работе</option>
                                        <option value="On Hold">На согласовании</option>
                                        <option value="Successful">Успешно</option>
                                        <option value="Rejected">Отклонено</option>
                                    </select>
                                    <button class="btn success" id="update-status-button">Обновить</button>
                                </div>
                                <div class="muted" id="time-spent-display" style="margin-top:6px; display:none;"></div>
                            </div>
                        </div>

                        <div id="chat-closed-banner" class="banner" style="display:none;">
                            Чат завершён. Новые сообщения отправлять нельзя — доступен только просмотр переписки и вложений.
                        </div>

                        <div id="chat-box" class="chat-box"></div>

                        <div class="card-body" style="border-top:1px solid var(--border);">
                            <div class="stack">
                                <div class="chat-actions" id="chat-actions">
                                    <input class="input" id="chat-input" placeholder="Ваш ответ...">
                                    <input type="file" id="chat-attachment" accept="image/*,video/*" style="display:none;">
                                    <button class="btn ghost" id="btn-pick">📎 Файл</button>
                                    <button class="btn ghost" id="btn-photo">📷 Фото</button>
                                    <button class="btn ghost" id="btn-video">🎥 Видео</button>
                                    <button class="btn" id="chat-send-button">Отправить</button>
                                </div>
                                <div class="preview" id="preview">
                                    <div id="preview-thumb"></div>
                                    <div class="row">
                                        <button class="btn ghost" id="btn-clear-preview">Убрать</button>
                                    </div>
                                </div>
                                <div class="muted" id="chat-hint">Подсказка: статус "Новые" автоматически сменится на "В работе" при первом ответе модератора.</div>
                            </div>
                        </div>
                    </div>
                    <!-- /Desktop chat panel -->
                </div>
            </section>

            <!-- USERS -->
            <section class="section" id="sec-users">
                <div class="toolbar">
                    <div class="row">
                        <button class="btn" id="btn-reload-users">Обновить список</button>
                    </div>
                    <div class="chips">
                        <span class="chip">Пользователей: <span id="users-total">0</span></span>
                    </div>
                </div>

                <div class="grid">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-wrap">
                                <table id="users-table" class="responsive">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Логин</th>
                                        <th>ФИО</th>
                                        <th class="col-phone">Телефон</th>
                                        <th>Роль</th>
                                        <th class="col-created-users">Создан</th>
                                        <th>Действие</th>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header"><h3>Создать пользователя</h3></div>
                        <div class="card-body">
                            <div class="stack">
                                <div class="form-grid" style="display:grid; grid-template-columns:repeat(2,1fr); gap:16px;">
                                    <input class="input" id="new-username" placeholder="Логин" />
                                    <input class="input" id="new-password" placeholder="Пароль" type="password" />
                                    <input class="input" id="new-fullname" placeholder="ФИО" />
                                    <input class="input" id="new-phone" placeholder="Телефон" />
                                    <select id="new-role" class="input">
                                        <option value="user">user</option>
                                        <option value="moderator">moderator</option>
                                    </select>
                                    <div class="row" style="grid-column:1/-1; gap:12px;">
                                        <button class="btn" id="btn-create-user">Создать</button>
                                        <div class="muted" id="create-user-msg"></div>
                                    </div>
                                </div>
                                <div class="muted">Примечание: создание пользователя может быть ограничено правами.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- REPORTS -->
            <section class="section" id="sec-reports">
                <div class="toolbar">
                    <div class="row">
                        <!-- Внутри секции Отчётов (sec-reports) в moder.html, в блоке toolbar -->
                        <button class="btn" id="btn-archive" onclick="window.location.href='/moder-archive.html'">
  Архив завершённых заявок
</button>

                        <input type="date" class="date" id="start_date" />
                        <input type="date" class="date" id="end_date" />
                        <button class="btn" id="btn-make-report">Сформировать</button>
                        <button class="btn ghost" id="btn-print" disabled>Печать</button>
                        
                    </div>
                </div>

                <div class="grid">
                    <div class="card">
                        <div class="card-header"><h3>Сводка</h3></div>
                        <div class="card-body" id="report-summary">
                            <div class="muted">Укажите период и нажмите "Сформировать".</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header"><h3>Детализация</h3></div>
                        <div class="card-body">
                            <div class="table-wrap">
                                <table id="report-table" class="responsive">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Тема</th>
                                        <th>Статус</th>
                                        <th>Пользователь</th>
                                        <th class="col-moderator">Модератор</th>
                                        <th>Создан</th>
                                        <th class="col-closed">Закрыт</th>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div class="muted" id="report-message"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PROFILE -->
            <section class="section" id="sec-profile">
                <div class="card">
                    <div class="card-body">
                        <h3>Мой профиль</h3>
                        <p class="muted">Вы вошли как: <strong id="profile-username">—</strong> (<span id="profile-role">—</span>)</p>
                        <div class="row">
                            <button class="btn danger" id="logout-2">Выйти</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Fixed mobile bottom tabs -->
    <div class="mobile-tab-bar" id="mobile-tab-bar">
        <a href="#" class="tab-item active" data-section="tickets"><i>🎫</i><span>Заявки</span></a>
        <a href="#" class="tab-item" data-section="users"><i>👥</i><span>Польз.</span></a>
        <a href="#" class="tab-item" data-section="reports"><i>📈</i><span>Отчёты</span></a>
        <a href="#" class="tab-item" data-section="profile"><i>👤</i><span>Профиль</span></a>
    </div>

    <!-- Mobile chat modal (телефон) -->
    <div class="mchat-modal" id="mchat-modal">
        <div class="mchat-wrap">
            <div class="mchat-head">
                <div>
                    <h3 class="mchat-title">Чат #<span id="mchat-ticket-id">—</span></h3>
                    <div class="mchat-sub">Тема: <span id="mchat-ticket-subject">—</span> • Статус: <strong id="mchat-status">—</strong></div>
                </div>
                <button class="mchat-close" id="mchat-close" aria-label="Закрыть чат">✕</button>
            </div>

            <div id="mchat-closed-banner" class="banner" style="display:none;">
                Чат завершён. Новые сообщения отправлять нельзя — доступен только просмотр переписки и вложений.
            </div>

            <div class="mstatus-bar">
                <select id="mstatus-select" class="input">
                    <option value="In Progress">В работе</option>
                    <option value="On Hold">На согласовании</option>
                    <option value="Successful">Успешно</option>
                    <option value="Rejected">Отклонено</option>
                </select>
                <button class="btn" id="mupdate-status-button">Обновить</button>
            </div>
            <div class="mstatus-info" id="mtime-spent-display" style="display:none;"></div>

            <div id="mchat-box" class="mchat-box"></div>

            <div class="mchat-actions" id="mchat-actions">
                <input class="input" id="mchat-input" placeholder="Сообщение" />
                <input type="file" id="mchat-attachment" accept="image/*,video/*" style="display:none;">
                <button class="mattach-toggle" id="mattach-toggle" aria-label="Вложения">＋</button>
                <button class="btn" id="mchat-send" title="Отправить" aria-label="Отправить">➤</button>

                <!-- Popover меню вложений -->
                <div class="mattach-menu" id="mattach-menu" role="menu" aria-hidden="true">
                    <button class="btn ghost" id="mbtn-pick">📎 Файл</button>
                    <button class="btn ghost" id="mbtn-photo">📷 Фото</button>
                    <button class="btn ghost" id="mbtn-video">🎥 Видео</button>
                </div>
            </div>

            <div class="mpreview" id="mpreview">
                <div id="mpreview-thumb"></div>
                <button class="btn ghost" id="mbtn-clear-preview">Убрать</button>
            </div>
        </div>
    </div>

    <!-- Модалка редактирования пользователя -->
    <div class="modal-overlay" id="edit-user-modal" aria-hidden="true">
        <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="edit-user-title">
            <div class="modal-head">
                <h3 class="modal-title" id="edit-user-title">Редактирование пользователя</h3>
                <button class="modal-close" id="edit-user-close" aria-label="Закрыть">✕</button>
            </div>
            <div class="modal-body">
                <div id="edit-user-message" class="muted"></div>
                <div class="stack">
                    <div>
                        <label for="edit-user-username" class="muted" style="display:block; margin-bottom:6px;">Логин (только чтение)</label>
                        <input id="edit-user-username" class="input" type="text" disabled>
                    </div>
                    <div>
                        <label for="edit-user-fullname" style="display:block; margin-bottom:6px;">ФИО</label>
                        <input id="edit-user-fullname" class="input" type="text" placeholder="Введите ФИО">
                    </div>
                    <div>
                        <label for="edit-user-phone" style="display:block; margin-bottom:6px;">Телефон</label>
                        <input id="edit-user-phone" class="input" type="text" placeholder="+7 ...">
                    </div>
                    <div>
                        <label for="edit-user-role" class="muted" style="display:block; margin-bottom:6px;">Роль (только чтение)</label>
                        <input id="edit-user-role" class="input" type="text" disabled>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn ghost" id="edit-user-cancel">Отмена</button>
                <button class="btn" id="edit-user-save">Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Локальный клиент Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    <script defer src="/js/moder.js"></script>
</body>
</html>